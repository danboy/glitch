/*! glitch 2014-03-18 */
var Filter=function(a,b){this.options=JS.merge({scale:{w:800,h:400}},b);var c=this.options.filters||{};this.options.filters=JS.merge({threshold:{amount:99},brightness:{adjustment:100}},c),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.image=a};Filter.prototype={imageData:function(){var a=this.image.width,b=this.image.height;return this.canvas.width=a,this.canvas.height=b,this.context.drawImage(this.image,0,0,this.options.scale.w,this.options.scale.h),this.context.drawImage(this.canvas,0,0,this.options.scale.w,this.options.scale.h,0,0,a,b),this.context.getImageData(0,0,a,b)},applyFilters:function(a){this.imageData=this.imageData();for(var b=a.length-1;b>=0;b-=1){var c=a[b];this.filters[c](this.imageData,this.canvas,this.options.filters[c])}return this.canvas},filters:{unfiltered:function(){},grayscale:function(a,b){for(var c=a.data,d=0;d<c.length;d+=4){var e=c[d],f=c[d+1],g=c[d+2],h=.2126*e+.7152*f+.0722*g;c[d]=c[d+1]=c[d+2]=h}return b.getContext("2d").putImageData(a,0,0),a},brightness:function(a,b,c){for(var d=c.adjustment,e=a.data,f=0;f<e.length;f+=4)e[f]+=d,e[f+1]+=d,e[f+2]+=d;return b.getContext("2d").putImageData(a,0,0),a},threshold:function(a,b,c){for(var d=a.data,e=0;e<d.length;e+=4){var f=d[e],g=d[e+1],h=d[e+2],i=.2126*f+.7152*g+.0722*h>=c.amount?255:0;d[e]=d[e+1]=d[e+2]=i}return b.getContext("2d").putImageData(a,0,0),a},noise:function(a,b){for(var c=a.data,d=0;d<c.length;d+=1){var e=c[Math.floor(Math.random()*c.length)],f=c[Math.floor(Math.random()*e)];c[Math.floor(Math.random()*c.length)]=c[f]}return b.getContext("2d").putImageData(a,0,0),a},redNoise:function(a,b){for(var c=a.data,d=c.length,e=0;d>e;e+=4){var f=Math.floor(Math.random()*e),g=Math.floor(Math.random()*f);c[e]=c[g]}return b.getContext("2d").putImageData(a,0,0),a},red:function(a,b){for(var c=a.data,d=0;d<c.length;d+=4){var e=c[d],f=c[d+1],g=c[d+2];c[d]=(e+f+g)/3,c[d+1]=c[d+2]=0}return b.getContext("2d").putImageData(a,0,0),a},glitch:function(a,b){for(var c=250,d=a.data,e=b.height,f=b.width,g=Math.floor(Math.random()*c),h=0;2>h;h++)for(var i=g*h,j=g*h,k=0;e>k;k++)for(var l=0;f>l;l++){var m=d[4*(f*k+l)],n=d[4*(f*k+l)+1],o=d[4*(f*k+l)+2];d[4*(f*k+l)]=m,d[4*(f*k+l)+i]=n,d[4*(f*k+l)+j]=o}return b.getContext("2d").putImageData(a,0,0),b},pixelate:function(a,b){var c=b.getContext("2d");c.mozImageSmoothingEnabled=!1,c.webkitImageSmoothingEnabled=!1,c.imageSmoothingEnabled=!1;var d=.001*Math.floor(50*Math.random());0>=d&&(d=.4);var e=b.height*d,f=b.width*d;try{c.drawImage(b,0,0,f,e)}catch(g){return void console.log("ERROR",g)}c.getImageData(0,0,f,e);c.drawImage(b,0,0,f,e,0,0,b.width,b.height)},scanlines:function(a,b){var c=b.getContext("2d");for(c.putImageData(a,0,0),c.fillStyle="rgba(0,0,0, .2)",i=0;i<b.height;i+=3)c.fillRect(0,i,b.width,1);var d=c.getImageData(0,0,b.width,b.height);return d}}};var Glitch=function(a,b,c){this.options=JS.merge({animationLength:800,animationFrames:6,filterCount:3,randomize:!1,filterOptions:{scale:{w:500,h:200},filters:{brightness:{adjustment:25}}},delay:2e4},c),this.setCache(a),this.options.filters||this.setFilters(),this.el=document.querySelectorAll(a)[0],JS.addClass(this.el,"glitch"),this.canvas=document.createElement("canvas"),JS.addClass(this.canvas,"glitch-canvas"),this.images=b,this.context=this.canvas.getContext("2d"),this.init()};Glitch.prototype={init:function(){this.currentImageIndex=0,this.firstRun=!0,this.reverseImages=!1,this.drawImage(),this.appendCanvas(),this.watchViewport()},setCache:function(a){this.id=a,window[this.id]=[]},setFilters:function(){var a=new Filter;this.options.filters=[];for(var b in a.filters)this.rollDice(3)===!0&&this.options.filters.length<this.options.filterCount&&this.options.filters.push(b);0===this.options.filters.length&&(this.options.filters=["glitch"])},appendCanvas:function(){this.canvas.setAttribute("width",1900),this.canvas.setAttribute("height",1080),this.el.insertBefore(this.canvas,this.el.firstChild)},selectImage:function(){return this.images[Math.floor(Math.random()*this.images.length)]},drawImage:function(){if(window[this.id].glitchImages=window[this.id].glitchImages||[],this.isStopped)return!1;var a=this.image=new Image;a.src=this.selectImage(),a.onload=function(){if(window[this.id].glitchImages[a.src])this.animate(window[this.id].glitchImages[a.src]);else{this.createFilteredImages(a)}}.bind(this)},applyDataToCanvas:function(a,b){b=b||0,this.setCanvasClass(a),this.context.drawImage(a,0,0,a.width,a.height,0,0,a.width,a.height)},setCanvasClass:function(a){return a.height<a.width?this.canvas.setAttribute("class","glitch-wide glitch-canvas"):this.canvas.setAttribute("class","glitch-tall glitch-canvas")},intervalLength:function(){var a=Math.floor(0===this.currentImageIndex?Math.random()*this.options.delay:this.options.animationLength/(this.options.animationFrames+1));return a},createFilteredImages:function(a){if(this.isStopped||!this.inView(this.el))return this.wait(this.createFilteredImages.bind(this)),!1;for(var b=[],c=0;c<this.options.animationFrames;c++)b[c]=this.filterImage(a,this.options.filters);this.firstRun&&(this.applyDataToCanvas(this.image),this.firstRun=!1),this.lastArray=this.filteredArray||b,this.filteredArray=b,window[this.id].glitchImages[this.image.src]=b,this.animate(b)},animate:function(a){if(this.isStopped||!this.inView(this.el))return this.wait(this.animate.bind(this)),!1;var b=this.currentImageIndex;b<a.length?setTimeout(function(){var c=a[b],d=0===b?0:Math.floor(c.width/b);0===b&&(this.canvas.setAttribute("width",c.width),this.canvas.setAttribute("height",c.height));this.options.slide?this.slide(c,this.lastArray[b],d):this.applyDataToCanvas(c);this.currentImageIndex++,this.animate(a)}.bind(this),this.intervalLength()):(this.currentImageIndex=0,this.applyDataToCanvas(this.image),this.options.randomize&&this.setFilters(),this.drawImage())},wait:function(a){setTimeout(function(){a(this.filteredArray)}.bind(this),this.options.delay)},slide:function(a,b,c){this.applyDataToCanvas(a,c),this.applyDataToCanvas(b,c-b.width)},stop:function(){this.isStopped=!0},start:function(){this.isStopped=!1},filterImage:function(a,b){var c=new Filter(a,this.options.filterOptions);return c.applyFilters(b.reverse())},drawOriginalImage:function(){this.applyDataToCanvas(this.filteredArray[0])},grayscaleImage:function(){var a=new Filter(this.filteredArray[0]);this.applyDataToCanvas(a.filters.grayscale(a.image,a.canvas,0))},watchViewport:function(){window.onscroll=function(){this.inView(this.el)?this.isStopped=!1:this.stop()}.bind(this)},inView:function(a){var b=this.offsetTop(a),c=a.offsetHeight;return b<window.pageYOffset+window.innerHeight&&b+c>window.pageYOffset},percentInView:function(a){var b=window.innerHeight,c=window.pageYOffset,d=this.offsetTop(a),e=a.offsetHeighteight;if(d>c+b)return 0;if(c>d+e)return 100;var f=c+b-d,g=f/((b+e)/100);return g=Math.round(g)},offsetTop:function(a){for(var b=a.offsetTop;a.offsetParent;)a=a.offsetParent,b+=a.offsetTop;return b},rollDice:function(a){return 0===Math.floor(Math.random()*a)}};var JS={merge:function(a,b){for(var c in b)a[c]=b[c];return a},size:function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},addClass:function(a,b){classNames=b.split(" ");try{classNames.forEach(function(b){a.classList.contains(b)||(a.className+=" "+b)})}catch(c){for(i=0;i<classNames.length;i++)-1===a.className.indexOf(classNames[i])&&(a.className+=" "+classNames[i])}},removeClass:function(a,b){classNames=b.split(" "),classNames.forEach(function(b){regex=new RegExp("(?:^|\\s)"+b+"(?!\\S)","g"),a.className=a.className.replace(regex,"")})},canHasStorage:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}};window.log=function(){log.history=log.history||[],log.history.push(arguments),this.console&&console.log(Array.prototype.slice.call(arguments))};var ImageGlitch=function(a,b){this.options=JS.merge({filters:["glitch","red"],framerate:100,delay:2e4},b),this.currentImageIndex=0,this.el=document.querySelectorAll(a)[0];var c=this.image=new Image;c.src=this.el.src,c.onload=function(){this.init(c)}.bind(this)};ImageGlitch.prototype={init:function(a){this.canvas=document.createElement("canvas"),this.el.style.visibility="hidden",this.el.parentNode.insertBefore(this.canvas,this.el),this.canvas.className=this.el.className,this.canvas.width=a.width,this.canvas.height=a.height,this.ctx=this.canvas.getContext("2d"),this.ctx.drawImage(a,0,0),this.glitch(a)},glitch:function(){for(var a=[],b=0;10>b;b++)a[b]=this.filterImage(this.el,this.options.filters);this.animate(a)},animate:function(a){var b=this.currentImageIndex;b<a.length?setTimeout(function(){var c=a[b];this.currentImageIndex++,this.updateSrc(c),this.animate(a)}.bind(this),this.options.framerate):(this.canvas.width=this.el.width,this.currentImageIndex=0,this.updateSrc(this.el),setTimeout(function(){this.animate(a)}.bind(this),Math.floor(Math.random()*this.options.delay)))},filterImage:function(a,b){var c=new Filter(a,{scale:{w:a.width,h:a.height}});return c.applyFilters(b)},updateSrc:function(a){this.ctx.drawImage(a,0,0)}};var IV=function(a,b){this.cb=b,this.elements=Sizzle(a),this.init()};IV.prototype={init:function(){window.onscroll=function(){this.elements.forEach(function(a){var b=this.inView(a)?this.percentInView(a):!1;this.cb(b,a)}.bind(this))}.bind(this)},inView:function(a){for(var b=a.offsetTop,c=a.offsetHeight;a.offsetParent;)a=a.offsetParent,b+=a.offsetTop;return b<window.pageYOffset+window.innerHeight&&b+c>window.pageYOffset},percentInView:function(a){return a.offsetTop}};