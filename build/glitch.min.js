/*! glitch 2014-03-04 */
var Filter=function(a){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.image=a};Filter.prototype={imageData:function(){var a=this.image.width,b=this.image.height;return this.canvas.setAttribute("width",a),this.canvas.setAttribute("height",b),this.context.drawImage(this.image,0,0),this.context.getImageData(0,0,a,b)},applyFilters:function(a){this.imageData=this.imageData();for(var b=a.length-1;b>=0;b-=1)this.filters[a[b]](this.imageData,this.canvas);return this.imageData},filters:{unfiltered:function(a){return a},grayscale:function(a){for(var b=a.data,c=0;c<b.length;c+=4){var d=b[c],e=b[c+1],f=b[c+2],g=.2126*d+.7152*e+.0722*f;b[c]=b[c+1]=b[c+2]=g}return a},brightness:function(a){for(var b=95,c=a.data,d=0;d<c.length;d+=4)c[d]+=b,c[d+1]+=b,c[d+2]+=b;return a},threshold:function(a,b){b=b||11;for(var c=a.data,d=0;d<c.length;d+=4){var e=c[d],f=c[d+1],g=c[d+2],h=.2126*e+.7152*f+.0722*g>=b?255:0;c[d]=c[d+1]=c[d+2]=h}return a},noise:function(a){for(var b=a.data,c=0;c<b.length;c+=1){var d=b[Math.floor(Math.random()*b.length)],e=b[Math.floor(Math.random()*d)];b[Math.floor(Math.random()*b.length)]=b[e]}return a},redNoise:function(a){for(var b=a.data,c=b.length,d=0;c>d;d+=4){var e=Math.floor(Math.random()*d),f=Math.floor(Math.random()*e);b[d]=b[f]}return a},red:function(a){for(var b=a.data,c=0;c<b.length;c+=4){var d=b[c],e=b[c+1],f=b[c+2];b[c]=(d+e+f)/3,b[c+1]=b[c+2]=0}return a},glitch:function(a,b){for(var c=250,d=a.data,e=b.height,f=b.width,g=Math.floor(Math.random()*c),h=0;2>h;h++)for(var i=g*h,j=g*h,k=0;e>k;k++)for(var l=0;f>l;l++){var m=d[4*(f*k+l)],n=d[4*(f*k+l)+1],o=d[4*(f*k+l)+2];d[4*(f*k+l)]=m,d[4*(f*k+l)+i]=n,d[4*(f*k+l)+j]=o}return a},pixelate:function(a,b){var c=b.getContext("2d");c.mozImageSmoothingEnabled=!1,c.webkitImageSmoothingEnabled=!1,c.imageSmoothingEnabled=!1;var d=.001*Math.floor(50*Math.random());0>=d&&(d=.4);var e=b.height*d,f=b.width*d;try{c.drawImage(b,0,0,f,e)}catch(g){return void console.log("ERROR",g)}var h=c.getImageData(0,0,f,e);return h},blur:function(a){return this.convolution(a,[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9])},scanlines:function(a,b){var c=b.getContext("2d");for(c.putImageData(a,0,0),c.fillStyle="rgb(255,255,255)",i=0;i<b.height;i+=3)c.fillRect(0,i,b.width,2);var d=c.getImageData(0,0,b.width,b.height);return d},convolution:function(a,b,c){for(var d=Math.round(Math.sqrt(b.length)),e=Math.floor(d/2),f=a.data,g=a.width,h=a.height,i=g,j=h,k=document.createElement("canvas").getContext("2d"),l=k.createImageData(i,j),m=l.data,n=c?1:0,o=0;j>o;o++)for(var p=0;i>p;p++){for(var q=o,r=p,s=4*(o*i+p),t=0,u=0,v=0,w=0,x=0;d>x;x++)for(var y=0;d>y;y++){var z=q+x-e,A=r+y-e;if(z>=0&&h>z&&A>=0&&g>A){var B=4*(z*g+A),C=b[x*d+y];t+=f[B]*C,u+=f[B+1]*C,v+=f[B+2]*C,w+=f[B+3]*C}}m[s]=t,m[s+1]=u,m[s+2]=v,m[s+3]=w+n*(255-w)}return l}}};var Glitch=function(a,b,c){this.options=JS.merge({animationLength:500,animationFrames:10,delay:2e4,filters:["red","glitch","brightness"]},c),this.el=document.querySelectorAll(a)[0],JS.addClass(this.el,"glitch"),this.canvas=document.createElement("canvas"),JS.addClass(this.canvas,"glitch-canvas"),this.context=this.canvas.getContext("2d"),this.images=b,this.init()};Glitch.prototype={init:function(){this.currentImageIndex=0,this.firstRun=!0,this.reverseImages=!1,this.appendCanvas(),this.drawImage(),this.watchViewport()},appendCanvas:function(){this.canvas.setAttribute("width",1900),this.canvas.setAttribute("height",1080),this.el.insertBefore(this.canvas,this.el.firstChild)},selectImage:function(){return this.images[Math.floor(Math.random()*this.images.length)]},drawImage:function(){if(this.isStopped)return!1;var a=new Image;a.src=this.selectImage(),a.onload=function(){this.createFilteredImages(a)}.bind(this)},applyDataToCanvas:function(a,b){b=b||0,this.setCanvasClass(a),this.context.putImageData(a,b,0)},setCanvasClass:function(a){return a.height<a.width?this.canvas.setAttribute("class","glitch-wide glitch-canvas"):this.canvas.setAttribute("class","glitch-tall glitch-canvas")},intervalLength:function(){var a=0===this.currentImageIndex?Math.floor(Math.random()*this.options.delay):this.options.animationLength/(this.options.animationFrames+1);return a},createFilteredImages:function(a){if(this.isStopped)return!1;for(var b=[],c=0;c<this.options.animationFrames;c++){var d=0===c?["unfiltered"]:this.options.filters;b[c]=this.filterImage(a,d)}this.firstRun&&(this.applyDataToCanvas(b[0]),this.firstRun=!1),this.lastArray=this.filteredArray||b,this.filteredArray=b,this.animate(b)},animate:function(a){if(this.isStopped||!this.inView(this.el))return this.wait(this.animate.bind(this)),!1;var b=this.currentImageIndex;b<a.length?setTimeout(function(){var c=a[b],d=0===b?0:Math.floor(c.width/b);0===b&&(this.canvas.setAttribute("width",c.width),this.canvas.setAttribute("height",c.height));this.options.slide?this.slide(c,this.lastArray[b],d):this.applyDataToCanvas(c);this.currentImageIndex++,this.animate(a)}.bind(this),this.intervalLength()):(this.currentImageIndex=0,this.applyDataToCanvas(a[0]),this.drawImage())},wait:function(a){setTimeout(function(){a(this.filteredArray)}.bind(this),1e4)},slide:function(a,b,c){this.applyDataToCanvas(a,c),this.applyDataToCanvas(b,c-b.width)},stop:function(){this.isStopped=!0},start:function(){this.isStopped=!1},filterImage:function(a,b){var c=new Filter(a);return c.applyFilters(b)},drawOriginalImage:function(){this.applyDataToCanvas(this.filteredArray[0])},grayscaleImage:function(){var a=new Filter(this.filteredArray[0]);this.applyDataToCanvas(a.filters.grayscale(a.image,a.canvas,0))},watchViewport:function(){window.onscroll=function(){this.inView(this.el)?this.isStopped=!1:this.stop()}.bind(this)},inView:function(a){var b=this.offsetTop(a),c=a.offsetHeight;return b<window.pageYOffset+window.innerHeight&&b+c>window.pageYOffset},percentInView:function(a){var b=window.pageYOffset+window.innerHeight,c=this.offsetTop(a);return b-c},offsetTop:function(a){for(var b=a.offsetTop;a.offsetParent;)a=a.offsetParent,b+=a.offsetTop;return b},rollDice:function(a){return 0===Math.floor(Math.random()*a)}};var JS={merge:function(a,b){for(var c in b)a[c]=b[c];return a},size:function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},addClass:function(a,b){classNames=b.split(" "),classNames.forEach(function(b){a.classList.contains(b)||(a.className+=" "+b)})},removeClass:function(a,b){classNames=b.split(" "),classNames.forEach(function(b){regex=new RegExp("(?:^|\\s)"+b+"(?!\\S)","g"),a.className=a.className.replace(regex,"")})}},IV=function(a,b){this.cb=b,this.elements=Sizzle(a),this.init()};IV.prototype={init:function(){window.onscroll=function(){this.elements.forEach(function(a){var b=this.inView(a)?this.percentInView(a):!1;this.cb(b,a)}.bind(this))}.bind(this)},inView:function(a){for(var b=a.offsetTop,c=a.offsetHeight;a.offsetParent;)a=a.offsetParent,b+=a.offsetTop;return b<window.pageYOffset+window.innerHeight&&b+c>window.pageYOffset},percentInView:function(a){return a.offsetTop}};